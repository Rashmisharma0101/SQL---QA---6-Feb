table - adverse_events(device_id, event_date, severity).
Identify devices where serious adverse events increased by ‚â•30% month-over-month.
with cte1 as (select device_id, month(event_date) as  mn , severity from adverse_events),
cte2 as (sleect device_id, mn, severity, lag(severity) over (partition by device_id order by mn) as prev_deverity
from cte1),
cte3 as (select device_id, mn, (severity - prev_severity)/prev_severity * 100 as percentage_increase from cte2)
select device_id, mn , percentage_increase from cte3 where percentage_increase >= 30
-----------------------------------------------------------------------------------------------
2Ô∏è‚É£ Device Failure Rate After Implantation

Scenario:
implants(device_id, implant_date)
failures(device_id, failure_date)

Question:
Find device_ids whose 30-day failure rate is higher than the overall average 30-day failure rate 
across all devices

with cte1 as (select device_id, implant_date, failure_date
from implants i left join failure f on i.device_id = f.device_id
and datediff(implant_date, failure_date) <=30),
cte2 as (select device_id, case when failure_date is  not null then 1 else 0 end as tag
from cte1),
cte3 as (select device_id, avg(tag)*100 as overall_failurerate, avg(tag) over (partition by device_id) as device_failure_rate
from cte2)
select device_id from cte3 where device_failure_rate > overall_failurerate

-----------------------------------------------------------------------------------------------
3Ô∏è‚É£ Surgeon Performance Consistency
Scenario:
surgeries(surgeon_id, surgery_date, complication_flag)

Question:
Find surgeons who had complications in 3 or more consecutive surgeries.

with cte1 as (select surgeon_id, surgery_date, complication_flag from surgeries
where complication_flag = 1
order by surgeon_id, surgery_date),
cte2 as (select surgeon_id, surgery_date, row_number() over (partition by surgeon_id order by surgery_date) as rn
from cte1),
cte3 as (select surgeon_id, surgery_date-rn as diff from cte2)
select surgeon_id from cte2 group by surgeon_id, diff having count(*) >=3

-----------------------------------------------------------------------------------------------

4Ô∏è‚É£ Recall Impact Analysis

Scenario:
recalls(device_id, recall_date)
sales(device_id, sale_date)

Question:
Calculate sales drop percentage in 30 days post-recall vs 30 days pre-recall.



5Ô∏è‚É£ Hospital Risk Classification

Scenario:
hospital_events(hospital_id, event_date, severity)

Question:
Classify hospitals as:
High Risk ‚Üí above 90th percentile adverse events
Medium Risk
Low Risk

with cte1 as (select hospital_id, avg(severity)*100 as percentage_severity from hospital_events
group by hospital_id),
select hospital_id, case when percentage_severity > 90 then 'High Risk'
case when percentage_severity > 50 and percentage_severity <= 90 then 'Medium Risk'
else "low Risk"
end as risk_tag
from cte1

-------------------------------------------------------------------------------------------------
6Ô∏è‚É£ Duplicate Adverse Event Reporting

Scenario:
MAUDE-style reporting allows duplicates.

reports(report_id, device_id, event_date, patient_id)

Question:
Detect possible duplicate reports within 7 days for same patient & device.


7Ô∏è‚É£ Batch Quality Drift Detection

Scenario:
manufacturing_batches(batch_id, production_date, defect_rate)

Question:
Flag batches where defect rate deviates >2œÉ from rolling 10-batch average.

with cte1 as (select batch_id, production_date, defect_rate, average(defect_rate) over (order by production_date ROWS BETWEEN 9 PRECEDING AND CURRENT ROW) as rollingbatch
from manufacturing_batches)
select batch_id from cte1 where defect_rate > rollingbatch

-----------------------------------------------------------------------------------------------------

8Ô∏è‚É£ Patient Readmission Risk Pattern

Scenario:
admissions(patient_id, admit_date, discharge_date)

Question:
Find patients readmitted within 15 days, more than once.

select a.patient_id, a.admit_date, b.patient_id, b.admit_date from admissions a join admissions b
on a.patient_id = b.patient_id and a.admit_date - b.admit_date <= 15
group by a.patient_id
having count(*) > 1

----------------------------------------------------------------------------------------------


9Ô∏è‚É£ Device Usage Drop by Hospital

Scenario:
usage_logs(device_id, hospital_id, usage_date)

Question:
Detect hospitals where usage dropped ‚â•40% compared to 3-month moving average.










üîü Compliance SLA Breach Detection (Very Real)

Scenario:
complaints(complaint_id, received_date, closed_date)

Question:
Find percentage of complaints not closed within 30 days per quarter.



